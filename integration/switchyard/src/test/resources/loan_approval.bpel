<process name="loanApprovalProcess" targetNamespace="http://example.com/loan-approval/loanService/"
		xmlns="http://docs.oasis-open.org/wsbpel/2.0/process/executable"
		xmlns:lns="http://example.com/loan-approval/loanService/"
		xmlns:ans="http://example.com/loan-approval/riskAssessment/"
		suppressJoinFailure="yes">

   <import importType="http://schemas.xmlsoap.org/wsdl/" location="loanServicePT.wsdl"
      			namespace="http://example.com/loan-approval/loanService/" />
   <import importType="http://schemas.xmlsoap.org/wsdl/" location="riskAssessmentPT.wsdl"
      			namespace="http://example.com/loan-approval/riskAssessment/" />

   <partnerLinks>
      <partnerLink name="customer" partnerLinkType="lns:loanPartnerLT" myRole="loanService" />
      <partnerLink name="assessor" partnerLinkType="ans:riskAssessmentLT" partnerRole="assessor" />
   </partnerLinks>

   <variables>
      <variable name="request" messageType="lns:requestMessage" />
      <variable name="requestResponse" messageType="lns:requestResponseMessage" />
      <variable name="check" messageType="ans:checkMessage" />
      <variable name="checkResponse" messageType="ans:checkResponseMessage" />
      <variable name="faultResponse" messageType="lns:errorMessage" />
   </variables>

   <faultHandlers>
      <catch faultName="lns:loanProcessFault" faultVariable="error"
						faultMessageType="lns:errorMessage">
         <reply partnerLink="customer" portType="lns:loanServicePT" operation="request" variable="error"
            			faultName="lns:unableToHandleRequest" />
      </catch>
   </faultHandlers>

   <sequence>
      <receive partnerLink="customer" portType="lns:loanServicePT"
				operation="request" variable="request" createInstance="yes" />

        <assign validate="no" name="AssignName">
            <copy>
                <from><literal>
        <ns1:check xmlns:ns1="http://example.com/loan-approval/riskAssessment/">
		   <firstName></firstName>
		   <name></name>
		   <amount>1000</amount>
		</ns1:check>
</literal></from>
                <to variable="check" part="parameter"></to>
            </copy>
            <copy>
                <from variable="request" part="parameter" query="/request/amount" />
                <to variable="check" part="parameter" query="/check/amount" />
            </copy>
        </assign>
        
      <invoke partnerLink="assessor" portType="lns:riskAssessmentPT" operation="check" 
						inputVariable="check" outputVariable="checkResponse"/>


        <assign validate="no" name="AssignName">
            <copy>
                <from><literal><tns:RequestResponse xmlns:tns="http://example.com/loan-approval/loanService/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <tns:accept>yes</tns:accept>
</tns:RequestResponse>
</literal></from>
                <to variable="requestResponse" part="parameter"></to>
            </copy>
        </assign>

      <reply partnerLink="customer" portType="lns:loanServicePT"
							operation="request" variable="requestResponse"/>
   </sequence>

</process>
